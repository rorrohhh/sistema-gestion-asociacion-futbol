<% if (jugadores && jugadores.length > 0) { %>
    <% jugadores.forEach(function(jugador) { %>
        
        <% 
            let edad = "--";
            if (jugador.fecha_nacimiento) {
                const hoy = new Date();
                const nacimiento = new Date(jugador.fecha_nacimiento);
                let anios = hoy.getFullYear() - nacimiento.getFullYear();
                const mes = hoy.getMonth() - nacimiento.getMonth();
                if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) anios--;
                edad = anios;
            }
        %>

        <tr>
            <td class="ps-4"><span class="numero-camiseta"><%= jugador.numero %></span></td>
            
            <td>
                <div class="fw-bold text-dark texto-mayuscula">
                    <%= jugador.apellido_paterno %> <%= jugador.apellido_materno %>
                </div>
                <div class="text-muted small texto-mayuscula"><%= jugador.nombres %></div>
            </td>

            <td>
                <% if(jugador.rut_num) { %>
                    <% 
                        let rutVisual = jugador.rut_num.toString();
                        if (/^\d+$/.test(rutVisual)) { 
                            rutVisual = parseInt(rutVisual).toLocaleString('es-CL');
                        }
                    %>
                    <span class="rut-font"><%= rutVisual %>-<%= jugador.rut_dv %></span>
                <% } else { %> <span class="text-muted">--</span> <% } %>
            </td>

            <td class="text-center"><span class="rol-badge border"><%= jugador.rol_asociacion %></span></td>
            
            <td class="text-center text-muted">
                <% if(jugador.fecha_nacimiento) { %>
                    <%= new Date(jugador.fecha_nacimiento).toLocaleDateString('es-CL') %>
                <% } else { %> -- <% } %>
            </td>

            <td class="text-center">
                <% if(edad !== "--") { %>
                    <span class="edad-badge"><%= edad %> años</span>
                <% } else { %> -- <% } %>
            </td>

            <td>
                <span class="badge rounded-pill badge-club-destacado px-3 py-2 texto-mayuscula">
                    <%= jugador.nombre_club %>
                </span>
            </td>

            <td class="text-end pe-4">
                <div class="btn-group" role="group">
                    <a href="/jugadores/editar/<%= jugador.id %>" class="btn btn-sm btn-outline-primary border-0"><i class="bi bi-pencil-square fs-5"></i></a>
                    <a href="/jugadores/eliminar/<%= jugador.id %>" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('¿Borrar?')"><i class="bi bi-trash fs-5"></i></a>
                </div>
            </td>
        </tr>
    <% }); %>
<% } else { %>
    <tr>
        <td colspan="8" class="text-center py-5 text-muted">
            <i class="bi bi-emoji-frown display-4 d-block mb-3"></i>
            <h5>No se encontraron resultados.</h5>
        </td>
    </tr>
<% } %>